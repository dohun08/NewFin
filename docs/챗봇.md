# NewFin 벤틀리 AI 챗봇 구현 요청

## 📋 개요
Flutter로 개발 중인 NewFin 앱에 **벤틀리 AI 챗봇**을 구현해주세요. 벤틀리는 사용자가 어떤 화면에 있든 항상 접근 가능한 금융 학습 도우미로, Gemini API를 활용하여 금융 관련 질문에 답변합니다.

---

## 🎯 핵심 컨셉

**벤틀리 = 앱 내장형 Gemini 챗봇**
- ChatGPT, Claude처럼 대화형 인터페이스
- 금융 관련 질문 특화
- 10대 눈높이 친근한 답변
- 모든 화면에서 접근 가능

---

## 🐻 Part 1: 플로팅 벤틀리 버튼

### 1-1. 위치 & 디자인

**모든 화면 오른쪽 하단에 고정:**
```
┌─────────────────────────────────────┐
│  [헤더]                              │
│                                      │
│  [컨텐츠 영역]                       │
│                                      │
│                                      │
│                                      │
│                           🐻         │ ← 벤틀리 버튼
│                         (bentley)    │    (오른쪽 하단)
│                                      │
└─────────────────────────────────────┘
```

**버튼 스타일:**
- 원형 플로팅 버튼 (FloatingActionButton)
- 크기: 60x60px
- 배경: 흰색 또는 연한 보라색 (#F3E5F5)
- 그림자: elevation 4
- 이미지: `assets/bentley.png` (40x40px)
- 테두리: 2px, 보라색 (#5409DB)

**애니메이션:**
- 처음 화면 로드 시: 아래에서 위로 슬라이드인
- 스크롤 시: 항상 고정 위치 유지
- 탭 시: 살짝 축소했다가 확대 (scale 0.9 → 1.0)
- 새 메시지 도착 시: 부드럽게 흔들림 (shake)

### 1-2. 알림 배지

**미확인 메시지 있을 때:**
```
         🐻
       1️⃣  ← 빨간 배지 (숫자)
```

- 벤틀리 버튼 우상단에 빨간 배지
- 미확인 메시지 개수 표시
- 최대 9까지, 10 이상은 "9+"

---

## 💬 Part 2: 채팅 화면

### 2-1. 화면 전환

**벤틀리 버튼 클릭 시:**
- 하단에서 위로 슬라이드 전환
- 전체 화면 모달 (fullscreenDialog)
- 뒤로가기: 슬라이드 다운

### 2-2. 채팅 화면 레이아웃

```
┌─────────────────────────────────────┐
│  [<-]  벤틀리와 대화  [새대화] [더보기] │ ← 헤더
├─────────────────────────────────────┤
│                                      │
│  [채팅 메시지 영역]                  │ ← 스크롤 가능
│                                      │
│  🐻 벤틀리                            │
│  ┌──────────────────────┐           │
│  │ 안녕! 금융 공부 도와줄게!│          │
│  │ 뭐든 물어봐!          │           │
│  └──────────────────────┘           │
│  10:23                               │
│                                      │
│                   나 👤              │
│           ┌──────────────────────┐  │
│           │ 주식이 뭐야?          │  │
│           └──────────────────────┘  │
│                   10:24              │
│                                      │
│  🐻 벤틀리                            │
│  ┌──────────────────────┐           │
│  │ 주식은 회사의 소유권을│           │
│  │ 나눠 가진 거예요...   │           │
│  └──────────────────────┘           │
│  [👍 👎]  10:24                      │
│                                      │
├─────────────────────────────────────┤
│  [+] [메시지 입력...] [전송]         │ ← 입력바 (고정)
└─────────────────────────────────────┘
```

### 2-3. 헤더 구성

**왼쪽:**
- [<-] 뒤로가기 버튼 (채팅 닫기)

**중앙:**
- 🐻 벤틀리 아이콘 (작게, 20px)
- "벤틀리와 대화" 제목

**오른쪽:**
- [새대화] 버튼 (대화 초기화)
- [더보기] 메뉴 (설정, 대화 내보내기 등)

### 2-4. 메시지 디자인

**벤틀리 메시지 (왼쪽 정렬):**
- 프로필 이미지: bentley.png (32x32px)
- 말풍선: 흰색 배경, 회색 테두리
- 텍스트: 검은색, 14pt
- 시간: 회색, 작게 (10pt)
- 피드백 버튼: 👍 👎 (좋아요/싫어요)

**사용자 메시지 (오른쪽 정렬):**
- 프로필 이미지: 기본 아이콘 (옵션)
- 말풍선: 보라색 배경 (#5409DB), 흰색 텍스트
- 시간: 회색, 작게

**로딩 메시지:**
```
🐻 벤틀리
┌──────────────────────┐
│ 생각 중... ⏳        │
│ ●●●                 │ ← 점 3개 애니메이션
└──────────────────────┘
```

### 2-5. 입력바 구성

**레이아웃:**
```
┌─────────────────────────────────────┐
│ [+] [메시지를 입력하세요...] [전송]  │
└─────────────────────────────────────┘
```

**구성 요소:**
- [+] 버튼: 이미지 첨부 (옵션, 향후 확장)
- 텍스트 입력창: 
  - Placeholder: "메시지를 입력하세요..."
  - 자동 확장 (최대 4줄)
  - 엔터 키로 전송
- [전송] 버튼:
  - 아이콘: 종이비행기 또는 화살표
  - 색상: 보라색 (#5409DB)
  - 비활성화: 입력 없을 때 회색

---

## 🤖 Part 3: Gemini API 연동

### 3-1. 프롬프트 설정

**시스템 프롬프트 (벤틀리 페르소나):**
```
너는 NewFin 앱의 금융 학습 도우미 '벤틀리'야.
안경 쓴 귀여운 갈색 곰이고, 항상 친절하고 상냥해.

역할:
- 10대 후반(17-19세) 학생들에게 금융을 쉽게 가르쳐줘
- 어려운 용어는 괄호로 쉬운 말을 추가해
- 2-3문장으로 간결하게 답변해
- 필요하면 예시를 들어줘
- 이모지를 적절히 사용해 친근하게
- "~이에요", "~해요" 존댓말 사용

금지 사항:
- 투자 권유나 특정 종목 추천 금지
- 복잡한 전문용어 나열 금지
- 4문장 이상 긴 답변 지양

예시:
질문: "주식이 뭐야?"
답변: "주식은 회사의 소유권을 나눠 가진 거예요 📊 
예를 들어 삼성전자 주식을 사면 삼성전자의 주인 중 한 명이 되는 거죠. 
회사가 잘 되면 주가가 오르고, 안 좋으면 내려가요!"
```

### 3-2. API 호출 흐름

**사용자 메시지 전송:**
```
1. 사용자 입력 → UI에 즉시 표시 (오른쪽)
2. 로딩 메시지 표시 (왼쪽, "생각 중... ●●●")
3. Gemini API 호출
   - model: "gemini-pro"
   - system: 벤틀리 페르소나 프롬프트
   - messages: 이전 대화 히스토리 포함 (최근 10개)
4. 응답 받기
5. 로딩 메시지 → 벤틀리 답변으로 교체
6. 답변 애니메이션 (페이드인)
```

### 3-3. 대화 히스토리 관리

**SQLite에 저장:**
- 테이블: chat_messages
- 컬럼: id, role (user/assistant), content, timestamp
- 최근 50개 메시지만 유지
- 대화 시작 시 최근 10개 로드 (컨텍스트)

**새 대화 시작:**
- 기존 대화 아카이브
- 히스토리 초기화
- 환영 메시지 표시

---

## 💡 Part 4: 특수 기능

### 4-1. 빠른 질문 버튼

**첫 대화 시작 시 제안:**
```
🐻 벤틀리
┌──────────────────────┐
│ 안녕! 뭐가 궁금해? 😊 │
└──────────────────────┘

[💰 금리가 뭐야?]
[📈 주식 시작하려면?]
[💵 환율이 왜 변해?]
[🏦 은행 vs 증권사?]
```

- 버튼 클릭 시 자동 전송
- 자주 묻는 질문 4-5개

### 4-2. 관련 용어 링크

**답변에 금융 용어 포함 시:**
```
🐻 벤틀리
┌──────────────────────┐
│ 금리는 돈을 빌릴 때  │
│ 내는 이자의 비율...  │
│                      │
│ 📚 [금리] [이자]     │ ← 링크
└──────────────────────┘
```

- 답변 하단에 언급된 용어 버튼
- 클릭 시 → 용어 사전 페이지로 이동

### 4-3. 답변 피드백

**각 벤틀리 답변 하단:**
```
┌──────────────────────┐
│ 답변 내용...         │
└──────────────────────┘
[👍 도움됐어요] [👎 별로예요]
```

- 좋아요/싫어요 버튼
- 피드백 DB 저장 (향후 개선용)
- 클릭 시 토스트: "피드백 감사해요!"

### 4-4. 음성 입력 (옵션)

**입력바에 마이크 버튼 추가:**
- [+] [입력창] [🎤] [전송]
- speech_to_text 패키지 사용
- 음성 → 텍스트 변환 → 자동 입력

---

## 🎨 Part 5: UI/UX 디테일

### 5-1. 애니메이션

**메시지 등장:**
- 페이드인 + 아래에서 위로 슬라이드
- 타이핑 효과 (한 글자씩, 빠르게)

**로딩:**
- 점 3개 순차 애니메이션 (●●● → ●●○ → ●○○ 반복)

**버튼 탭:**
- 리플 효과 (물결)

### 5-2. 스크롤 동작

**새 메시지 수신 시:**
- 자동으로 최하단 스크롤
- 부드러운 애니메이션

**사용자가 위로 스크롤 중일 때:**
- 자동 스크롤 방지
- 하단에 "새 메시지 ▼" 버튼 표시

### 5-3. 에러 처리

**API 호출 실패 시:**
```
🐻 벤틀리
┌──────────────────────┐
│ 앗, 잠깐 문제가 생겼어요 😅│
│ 다시 한번 물어봐줄래요? │
└──────────────────────┘
[다시 시도]
```

**네트워크 없을 때:**
```
⚠️ 인터넷 연결을 확인해주세요
벤틀리는 온라인일 때 답변할 수 있어요!
```

---

## 📱 Part 6: 화면별 통합

### 6-1. 모든 화면에 벤틀리 버튼

**적용 화면:**
- ✅ 홈 화면
- ✅ 학습 시나리오 화면
- ✅ 투자 화면
- ✅ 마이페이지
- ✅ 뉴스 상세 화면
- ✅ 퀴즈 화면
- ❌ 채팅 화면 자체 (중복 방지)
- ❌ 로그인/온보딩 화면

**구현 방법:**
- Scaffold의 floatingActionButton으로 구현
- 또는 Stack + Positioned로 전역 오버레이

### 6-2. 컨텍스트 인식 (선택)

**현재 화면 정보를 프롬프트에 포함:**

예시:
```
# 사용자가 투자 화면에 있을 때
시스템 프롬프트 추가:
"사용자는 지금 투자 화면에 있어. 
삼성전자 주식이 +1.5% 올랐다는 걸 보고 있어."

# 사용자 질문: "이거 사도 돼?"
→ Gemini: "삼성전자가 오르고 있네요! 
하지만 단기 상승만 보고 사는 건 위험해요..."
```

---

## 🗂 Part 7: 데이터베이스

### 7-1. 테이블 스키마

**chat_messages:**
```sql
CREATE TABLE chat_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  role TEXT NOT NULL,           -- 'user' or 'assistant'
  content TEXT NOT NULL,         -- 메시지 내용
  timestamp INTEGER NOT NULL,    -- Unix timestamp
  feedback INTEGER DEFAULT 0     -- 0: 없음, 1: 좋아요, -1: 싫어요
);
```

**chat_sessions:**
```sql
CREATE TABLE chat_sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  start_time INTEGER NOT NULL,
  end_time INTEGER,
  message_count INTEGER DEFAULT 0
);
```

### 7-2. 대화 관리

**새 대화:**
- 현재 세션 종료 (end_time 업데이트)
- 새 세션 생성
- 환영 메시지 추가

**대화 로드:**
- 최근 세션의 메시지 10개 불러오기
- 오래된 메시지는 아카이브

---

## 🎯 Part 8: 추가 기능 (선택)

### 8-1. 대화 내보내기

**[더보기] 메뉴:**
- "대화 내보내기" 버튼
- 텍스트 파일 또는 이미지로 저장
- 공유 기능

### 8-2. 벤틀리 테마

**설정에서 변경 가능:**
- 기본 벤틀리 (안경 곰)
- 다른 의상 (향후 확장)
- 다크 모드 대응

### 8-3. 북마크

**중요한 답변 저장:**
- 메시지 롱프레스 → "북마크" 메뉴
- 북마크한 답변 모아보기

---

## 🔧 구현 가이드

### 필요한 패키지

```yaml
dependencies:
  google_generative_ai: ^0.2.0  # Gemini API
  sqflite: ^2.3.0               # 로컬 DB
  intl: ^0.18.0                 # 시간 포맷
  flutter_markdown: ^0.6.0      # 마크다운 렌더링 (선택)
  speech_to_text: ^6.0.0        # 음성 입력 (선택)
```

### Gemini API 설정

```dart
import 'package:google_generative_ai/google_generative_ai.dart';

final model = GenerativeModel(
  model: 'gemini-pro',
  apiKey: 'YOUR_API_KEY',
);

// 시스템 프롬프트
const systemPrompt = '''
너는 NewFin 앱의 금융 학습 도우미 '벤틀리'야.
...
''';
```

### 메시지 전송 로직

```
1. 사용자 입력 받기
2. UI에 사용자 메시지 추가
3. DB에 저장
4. 로딩 메시지 표시
5. Gemini API 호출
   - 시스템 프롬프트 + 히스토리 + 새 질문
6. 응답 받기
7. 로딩 → 벤틀리 답변 교체
8. DB에 저장
9. 애니메이션
```

---

## ✅ 체크리스트

### 필수 구현
- [ ] 모든 화면에 플로팅 벤틀리 버튼
- [ ] 채팅 화면 (풀스크린 모달)
- [ ] 메시지 UI (사용자 오른쪽, 벤틀리 왼쪽)
- [ ] Gemini API 연동
- [ ] 벤틀리 페르소나 프롬프트 설정
- [ ] 대화 히스토리 DB 저장
- [ ] 로딩 애니메이션
- [ ] 에러 처리
- [ ] 새 대화 시작 기능

### 추가 구현
- [ ] 빠른 질문 버튼
- [ ] 피드백 (좋아요/싫어요)
- [ ] 관련 용어 링크
- [ ] 음성 입력
- [ ] 대화 내보내기
- [ ] 북마크

---

## 🎨 디자인 참고

**색상:**
- 벤틀리 말풍선 배경: #FFFFFF
- 벤틀리 말풍선 테두리: #E0E0E0
- 사용자 말풍선 배경: #5409DB
- 사용자 말풍선 텍스트: #FFFFFF
- 플로팅 버튼 배경: #F3E5F5
- 플로팅 버튼 테두리: #5409DB

**폰트:**
- 메시지 텍스트: 14pt, Regular
- 시간: 10pt, Light, 회색
- 입력창: 14pt, Regular

**간격:**
- 메시지 간격: 12px
- 말풍선 패딩: 12px (상하), 16px (좌우)
- 화면 마진: 16px

---

이 구조로 구현하면 사용자가 언제 어디서든 벤틀리에게 금융 질문을 할 수 있고, Gemini의 강력한 AI로 즉시 답변을 받을 수 있어요! 🐻✨

ChatGPT/Claude 스타일의 깔끔한 대화 UI + NewFin만의 벤틀리 캐릭터로 차별화! 🚀